package config

import (
	"errors"
	"os"
	"strconv"
)

type Config struct {
	Workers    int
	WebhookURL string
}

func NewConfig() (*Config, error) {
	workers_str, err := Getenv("WORKERS", "10", false)
	if err != nil {
		return nil, err
	}
	workers, err := strconv.Atoi(workers_str)
	if err != nil {
		return nil, err
	}
	webhookurl, err := Getenv("WEBHOOK_URL", "", true)
	if err != nil {
		return nil, err
	}
	if webhookurl == "" {
		return nil, errors.New("WEBHOOK_URL is not set .env")
	}
	return &Config{
		Workers:    workers,
		WebhookURL: webhookurl,
	}, nil
}

func Getenv(key string, def string, is_required bool) (string, error) {
	value := os.Getenv(key)
	if is_required && value == "" {
		return "", errors.New(key + "is not set .env")
	}
	if value == "" {
		return def, nil
	}
	return value, nil

}
